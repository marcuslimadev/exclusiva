<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Teste - Exclusiva CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .stat-card { transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-4px); }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-blue-600">üè° Exclusiva Lar - Dashboard Teste</h1>
                <p class="text-gray-600">Sistema de Atendimento WhatsApp com IA</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Leads -->
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Total de Leads</p>
                            <p id="total-leads" class="text-3xl font-bold text-gray-900">-</p>
                        </div>
                        <div class="bg-blue-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Conversas Ativas -->
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Conversas Ativas</p>
                            <p id="conversas-ativas" class="text-3xl font-bold text-gray-900">-</p>
                        </div>
                        <div class="bg-green-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Leads Novos -->
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Leads Novos</p>
                            <p id="leads-novos" class="text-3xl font-bold text-gray-900">-</p>
                        </div>
                        <div class="bg-yellow-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Leads Qualificados -->
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Qualificados</p>
                            <p id="leads-qualificados" class="text-3xl font-bold text-gray-900">-</p>
                        </div>
                        <div class="bg-purple-100 rounded-full p-3">
                            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Atividades Recentes -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">üìä Atividades Recentes</h2>
                </div>
                <div class="p-6">
                    <div id="atividades-list" class="space-y-4">
                        <p class="text-gray-500 text-center py-4">Carregando...</p>
                    </div>
                </div>
            </div>

            <!-- Leads -->
            <div class="bg-white rounded-lg shadow mt-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">üë• Leads</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Localiza√ß√£o</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Or√ßamento</th>
                            </tr>
                        </thead>
                        <tbody id="leads-table" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-gray-500">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Conversas -->
            <div class="bg-white rounded-lg shadow mt-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">üí¨ Conversas WhatsApp</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stage</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">√öltima Atividade</th>
                            </tr>
                        </thead>
                        <tbody id="conversas-table" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-gray-500">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <script>
        const API_URL = 'https://exclusiva-backend.onrender.com';

        // Carregar estat√≠sticas
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api-public/dashboard/stats`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('total-leads').textContent = data.data.leads.total;
                    document.getElementById('conversas-ativas').textContent = data.data.conversas.ativas;
                    document.getElementById('leads-novos').textContent = data.data.leads.novos;
                    document.getElementById('leads-qualificados').textContent = data.data.leads.qualificados;
                }
            } catch (error) {
                console.error('Erro ao carregar stats:', error);
            }
        }

        // Carregar atividades
        async function loadAtividades() {
            try {
                const response = await fetch(`${API_URL}/api-public/dashboard/atividades`);
                const data = await response.json();
                
                if (data.success) {
                    const html = data.data.map(ativ => `
                        <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                            <span class="text-2xl">üí¨</span>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">${ativ.descricao}</p>
                                <p class="text-xs text-gray-500">${new Date(ativ.timestamp).toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('atividades-list').innerHTML = html;
                }
            } catch (error) {
                console.error('Erro ao carregar atividades:', error);
            }
        }

        // Carregar leads
        async function loadLeads() {
            try {
                const response = await fetch(`${API_URL}/api-public/leads`);
                const data = await response.json();
                
                if (data.success) {
                    const html = data.data.slice(0, 10).map(lead => `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${lead.nome || 'Sem nome'}</div>
                                <div class="text-xs text-gray-500">${lead.whatsapp_name || ''}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lead.telefone}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lead.localizacao || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(lead.status)}">
                                    ${lead.status}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${lead.budget_min && lead.budget_max ? 
                                    `R$ ${parseInt(lead.budget_min).toLocaleString('pt-BR')} - R$ ${parseInt(lead.budget_max).toLocaleString('pt-BR')}` 
                                    : '-'}
                            </td>
                        </tr>
                    `).join('');
                    document.getElementById('leads-table').innerHTML = html;
                }
            } catch (error) {
                console.error('Erro ao carregar leads:', error);
            }
        }

        // Carregar conversas
        async function loadConversas() {
            try {
                const response = await fetch(`${API_URL}/api-public/conversas`);
                const data = await response.json();
                
                if (data.success) {
                    const html = data.data.slice(0, 10).map(conv => `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">${conv.whatsapp_name || conv.telefone}</div>
                                <div class="text-xs text-gray-500">${conv.lead_nome || ''}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${conv.telefone}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">
                                    ${conv.stage || 'inicial'}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${conv.status === 'ativa' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                    ${conv.status}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${new Date(conv.ultima_atividade).toLocaleString('pt-BR')}
                            </td>
                        </tr>
                    `).join('');
                    document.getElementById('conversas-table').innerHTML = html;
                }
            } catch (error) {
                console.error('Erro ao carregar conversas:', error);
            }
        }

        function getStatusColor(status) {
            const colors = {
                'novo': 'bg-blue-100 text-blue-800',
                'em_atendimento': 'bg-yellow-100 text-yellow-800',
                'qualificado': 'bg-green-100 text-green-800',
                'proposta': 'bg-purple-100 text-purple-800',
                'fechado': 'bg-green-100 text-green-800',
                'perdido': 'bg-red-100 text-red-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        // Carregar tudo ao iniciar
        loadStats();
        loadAtividades();
        loadLeads();
        loadConversas();

        // Atualizar a cada 30 segundos
        setInterval(() => {
            loadStats();
            loadAtividades();
            loadLeads();
            loadConversas();
        }, 30000);
    </script>
</body>
</html>
